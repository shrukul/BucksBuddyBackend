/**
 *  jQuery.stepModal (Version: 1.0)
 *
 *  https://github.com/stepframe/jquery-stepModal
 *
 *  The MIT License (MIT)
 *  Copyright (c) 2013, Stepframe Interactive Media
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a
 *  copy of this software and associated documentation files (the "Software"),
 *  to deal in the Software without restriction, including without limitation
 *  the rights to use, copy, modify, merge, publish, distribute, sublicense,
 *  and/or sell copies of the Software, and to permit persons to whom the
 *  Software is furnished to do so, subject to the following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in
 *  all copies or substantial portions of the Software.
 *
 **/
!function(a,b,c,d){function g(e,g,h){var i=this;this.eventObject=a(e),this.popContainer=!1,this.contents=!1,h&&(this.contents=a(h)),this.setupTransitions(),this.opts={},g&&(g.transition&&!g.transitionIn&&(g.transitionIn=g.transition),g.transition&&!g.transitionOut&&(g.transitionOut=g.transition),g.transitionIn&&!g.transitionOut&&(g.transitionOut=g.transitionIn)),this.opts=a.extend({},f,g),this.opts.transition&&"object"==typeof this.opts.transition&&2==this.opts.transition.length&&(this.opts.transitionIn=this.opts.transition[0],this.opts.transitionOut=this.opts.transition[1]),this.transitionIn=this.opts.transitionIn&&"function"==typeof this.opts.transitionIn?this.opts.transitionIn:this.transitionsIn[this.opts.transitionIn],this.transitionIn==d&&(this.transitionIn=this.defaultTransitionIn),this.transitionOut=this.opts.transitionOut&&"function"==typeof this.opts.transitionOut?this.opts.transitionOut:this.transitionsOut[this.opts.transitionOut],this.transitionOut==d&&(this.transitionOut=this.defaultTransitionOut),this.init(),this.showBackground=function(){i.popContainer.fadeIn(i.opts.backgroundTransitionSpeed,function(){i.opts.onOpen&&i.opts.onOpen(i.contents),i.triggerEvent("sfModalOpen")})},this.hideBackground=function(a){var b=i.opts.contentAnimationDelay;a||(b=0),setTimeout(function(){i.popContainer.fadeOut(i.opts.backgroundTransitionSpeed),i.opts.onClose&&i.opts.onClose(i.contents),i.triggerEvent("sfModalClose")},b)},this.hideModal=function(){this.logMsg("hide modal"),a(c).unbind("keyup",this.keyUpEvent);var b=i.contents;b&&i.transitionOut&&i.transitionOut(b),i.hideBackground(i.opts.delayBackgroundAnimation)},this.getContainer=function(){return i.popContainer||(this.logMsg("create modal"),i.popContainer=a("<div/>",{"class":i.opts.modalClass}).appendTo(i.opts.appendSelector)),a(i.popContainer)},this.ModalContent=function(b){var c=a(b),d=!1;if(i.opts.dataAttribute){var e=c.data(i.opts.dataAttribute);e&&e.length>0&&(a(e).length>0?d=a(e):"#"!=e.substring(0,1)&&a("#"+e).length>0&&(d=a("#"+e)))}var f=c.attr("href");return f&&f.length>0&&(a(f).length>0?d=a(f):"#"!=f.substring(0,1)&&a("#"+f).length>0&&(d=a("#"+f))),d&&d.closest("."+i.opts.modalClass).length>0&&(i.popContainer=d.closest("."+i.opts.modalClass)),d},this.keyUpEvent=function(a){i.logMsg("Key Up");var b=27;a.keyCode==b&&i.hideModal()},this.showModal=function(b){this.contents||(this.contents=this.ModalContent(b));var d=this.getContainer();if(this.contents){var e=this.contents;d.append(e),e.css("display","block"),i.opts.modal||(e.click(function(a){a.stopPropagation()}),d.click(function(a){a.stopPropagation(),i.hideModal()}),a(c).keyup(i.keyUpEvent)),this.logMsg("show modal"),this.showBackground(),i.transitionIn&&i.transitionIn(e,i.opts.delayBackgroundAnimation),a(e).find(this.opts.closeSelector).each(function(){a(this).data("sfclickDefined")||(a(this).data("sfclickDefined",!0),a(this).click(function(){i.hideModal()}))})}},this.triggerEvent=function(a){this.eventObject&&this.eventObject.trigger(a)},this.logMsg=function(a){i.opts.debug&&b.console&&console.log(a)}}var e="stepModal",f={debug:!1,transition:"fade",transitionIn:"fade",transitionOut:"fade",closeSelector:".modal-close",transitionInTime:"slow",transitionOutTime:"fast",dataAttribute:"modaltarget",modal:!0,modalClass:"stepModal",appendSelector:"body",backgroundTransitionSpeed:"fast",contentAnimationDelay:250,delayBackgroundAnimation:!0,onOpen:!1,onClose:!1};g.prototype.init=function(){var a=this;this.eventObject.click(function(b){b.preventDefault(),a.showModal(this)})},g.prototype.setupTransitions=function(){var a=this,b=function(b,c){b.hide();var d=a.opts.contentAnimationDelay;c||(d=0),setTimeout(function(){b.fadeIn(a.opts.transitionInTime)},d)},c=function(b){var c=b.css("position");c&&"static"!=c||b.css("position","relative"),b.css("top",-1*a.popContainer.height()+"px");var d=a.opts.contentAnimationDelay;delay||(d=0),setTimeout(function(){b.animate({top:0},a.opts.transitionInTime)},d)},d=function(b,c){this.logMsg("fade out");var d=a.opts.contentAnimationDelay;c||(d=0),setTimeout(function(){b.fadeOut(a.opts.transitionOutTime)},d)},e=function(b){var c=b.css("position");c&&"static"!=c||b.css("position","relative");var d=a.opts.contentAnimationDelay;delay||(d=0),setTimeout(function(){b.animate({top:-1.5*a.popContainer.height()},a.opts.transitionOutTime)},d)},f=function(b){var c=a.opts.contentAnimationDelay;delay||(c=0),setTimeout(function(){b.show()},c)},g=function(b){var c=a.opts.contentAnimationDelay;delay||(c=0),setTimeout(function(){b.hide()},c)};this.defaultTransitionIn=b,this.defaultTransitionOut=d,this.transitionsIn={fade:b,slideDown:c,show:f},this.transitionsOut={fade:d,slideDown:e,show:g}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})},a.fn.showStepModal=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b,this));var c=a.data(this,"plugin_"+e);c.showModal(this)})}}(jQuery,window,document);